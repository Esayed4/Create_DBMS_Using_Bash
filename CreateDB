#!/usr/bin/bash

create_db() {
    # Get database name with Zenity input dialog
    dbname=$(zenity --entry \
        --title="Create Database" \
        --text="Enter database name:" \
        --width=400 --height=150)

    # Check if user cancelled (empty input)
    if [[ -z "$dbname" ]]; then
        zenity --error --text="Operation cancelled." --title="Error"
        return
    fi

    # Validate name format
    if [[ ! "$dbname" =~ ^[A-Za-z][A-Za-z0-9_]*$ ]]; then
        zenity --error \
            --text="Invalid name.\nMust start with letter, contain only letters, numbers, underscores." \
            --title="Invalid Name"
        return
    fi

    # Prefix with username
    prefixed_dbname=$(whoami)_$dbname
    
    # Check if exists
    if [[ -d "./DBs/$prefixed_dbname" ]]; then
        zenity --error \
            --text="Database '$prefixed_dbname' already exists." \
            --title="Database Exists"
        return
    fi

    # Create database
    mkdir "./DBs/$prefixed_dbname"
    chmod 770 "./DBs/$prefixed_dbname"
    
    zenity --info \
        --text="Database '$prefixed_dbname' created successfully." \
        --title="Success"
}

create_db
